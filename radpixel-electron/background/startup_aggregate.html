<script>
  const { PythonShell } = require("python-shell");
  const { ipcRenderer } = require("electron");
  const path = require("path");
  const log = require("electron-log");

  // when hidden renderer hasbeen initialized properly, start function that will start python script
  ipcRenderer.on("START_PROCESSING", (event, args) => {
    // kill last process if it is still running
    let lastPid = args.currentPid;
    log.info("value of lastPid", lastPid);

    const data = args.data;
    const pythonPath = args.pythonPath;

    log.info("starting with python path", pythonPath);
    log.info("script location", path.join(__dirname, "/../scripts/startup_aggregate.py"));
    log.info("args", data);

    // need a fully qualified for startup_agreaget too byt that is what __dirname
    let pyshell = new PythonShell(
      path.join(__dirname, "/../scripts/startup_aggregate.py"),
      {
        // need fully qualified python path
        // pythonPath: "/opt/anaconda3/bin/python3",
        pythonPath: pythonPath,
        args: data,
      }
    );

    lastPid = pyshell.childProcess.pid;
    log.info("starting process with pid: ", lastPid);
    ipcRenderer.send("PID_FROM_BACKGROUND", { message: lastPid });

    pyshell.on("message", function (results) {
      ipcRenderer.send("MESSAGE_FROM_BACKGROUND", { message: results });
    });
  });

  ipcRenderer.send("BACKGROUND_READY");
</script>
